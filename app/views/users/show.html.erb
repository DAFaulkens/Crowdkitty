<h1><%= @user.username %></h1>

<div class="profile_box">
  <div class="profile_image">
    <%= image_tag(@user.user_image.url, alt: "Profile Image", width:400) %>
  </div>
  <div class="profile_info">
    <p>Full name:<%= @user.name %> <%= @user.last_name %></p>
    <p>Location: <%= @user.city %> </p>
  </div>
</div>

<h3>Projects</h3>
<div class="cards">
  <% @user.projects.each do |project| %>
  <div class='card'>
    <div class="card-image">
      <%= link_to image_tag(project.project_image), project_path(project) %>
    </div>
    <div class='card-header'><%= link_to project.name, project_path(project) %></div>
    <div class='card-copy'><p><%= project.summary %></p></div>
  </div>
  <% end %>
</div>
<br>

<h3>Pledges made</h3>

<div class="cards">
  <% @user.pledges.each do |pledge| %>
  <div class='card'>
    <div class='card-header'>
      <%= pledge.project.name %>
    </div>
    <div class='card-copy'>
      <div class="pledge">
        <% if pledge.project.active? || pledge.project.success %>

          <% if current_user %>
            <% if pledge.project.success && pledge.user.id == current_user.id && (pledge.paid == false) %>
            <div class="payment_due"> 
              <p><strong>Project reached target! This Payment is now due.</strong></p> 
            </div>
            <% end %>
          <% end %>
          Pledge value: Â£<%= pledge.value %>

          <% if current_user %>
            <% if @user.id == current_user.id %>

            <% if pledge.project.success_and_closed && (pledge.paid == false) %>
            <%= button_to 'Pay now',  edit_project_pledge_path( pledge.project.id, pledge.id),method: :get %>
            <% end %>
            <% if pledge.project.success_and_closed && (pledge.paid == true) %>
            <div class="received">
              <strong>Payment received, thank you.</strong>
            </div>
            <% end %>
             <p><%= link_to "show details", pledge_path(pledge)%></p>
            <% end %>
          <% end %>

        <% else %>
        <% if (pledge.project.active? == false) && (pledge.project.success == false) %>
          <div class="project_failed"> 
            <p><strong><%= "#{pledge.project.name} failed to meet target, pledge deleted." %></strong></p>
          </div>
          <% end %>
        <% end %> 
      </div>
    </div>
  </div>
  <% end %>

</div>

<% if current_user %>
<% if @user.id == current_user.id %>
<div class="input"><%= link_to "Edit or cancel account", edit_user_registration_path %></div>
<% end %>
<% end %>


