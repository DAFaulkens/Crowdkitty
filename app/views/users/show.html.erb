<h1><%= @user.username %></h1>

<div class="profile_box">
  <div class="profile_image">
    <%= image_tag(@user.user_image.url, alt: "Profile Image", width:400) %>
  </div>
  <div class="profile_info">
    <p>Full name:<%= @user.name %> <%= @user.last_name %></p>
    <p>Location: <%= @user.city %> </p>
  </div>
</div>

<h3>Projects</h3>
<div class="cards">
  <% @user.projects.each do |project| %>
  <div class='card'>
    <div class="card-image">
      <%= link_to image_tag(project.project_image), project_path(project) %>
    </div>
    <div class='card-header'><%= link_to project.name, project_path(project) %></div>
    <div class='card-copy'><p><%= project.summary %></p></div>
  </div>
  <% end %>
</div>
<br>

<h3>Pledges made</h3>

<% @user.pledges.each do |pledge| %>

<div class="pledge">

<h2><%= pledge.project.name %></h2>
  <br>
  Â£<%= pledge.value %>
  <br>
  <br>
  <% if current_user %>
  <% if @user.id == current_user.id %>
  
  <% if pledge.project.success_and_closed && (pledge.paid == false) %>
  <%= button_to 'Pay now',  edit_project_pledge_path( pledge.project.id, pledge.id),method: :get  %>
  <%end%>

  <% if pledge.project.success_and_closed && (pledge.paid == true) %>
  <div class="received">
    <p>Payment received, thank you.</p>
  </div>
  <% end %>

  <% if (pledge.project.active? == false) && (pledge.project.success == false) %>

  <div class="failed_project">
    <p>This project failed to meet it's target.</p>
  </div>
  <% end %>

  <%= link_to "Show Details", pledge_path(pledge)%> 
  <% end %>
  
  <% end %>


</div>
<br>
<br>
<% end %>

<% if current_user %>
<div class="input"><%= link_to "Edit or cancel account", edit_user_registration_path if @user == User.find(current_user.id) %></div>
<% end %>


